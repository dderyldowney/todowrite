#!/bin/bash

# updatechangelog - AFS FastAPI CHANGELOG.md Generator
# Regenerates CHANGELOG.md from git commit history following Keep a Changelog format

set -e

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}ðŸ“ AFS FastAPI CHANGELOG Generator${NC}"
echo -e "${BLUE}====================================${NC}"
echo

# Determine project root relative to this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# Ensure we're in project root
cd "${PROJECT_ROOT}"

# Check if CHANGELOG.md exists
if [ ! -f "CHANGELOG.md" ]; then
    echo -e "${YELLOW}âš ï¸  CHANGELOG.md not found at project root${NC}"
    echo "   Creating new CHANGELOG.md..."
    cat > CHANGELOG.md << 'EOF'
# Changelog

All notable changes to the AFS FastAPI Agricultural Robotics Platform will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

EOF
    echo -e "${GREEN}âœ… Created new CHANGELOG.md${NC}"
    echo
fi

# Execute Python script to update CHANGELOG
echo -e "${BLUE}ðŸ” Analyzing git commit history...${NC}"
python -m afs_fastapi.scripts.updatechangelog

echo
echo -e "${GREEN}ðŸ“‹ CHANGELOG.md Update Complete!${NC}"
echo
echo -e "${BLUE}Next steps:${NC}"
echo "   1. Review updated CHANGELOG.md"
echo "   2. Stage changes: git add CHANGELOG.md"
echo "   3. Commit with your code changes"
echo
